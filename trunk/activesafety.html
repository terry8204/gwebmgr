<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>主动安全</title>
    <link rel="shortcut icon" href="./favicon.ico"  type="image/x-icon" />
    <link rel="stylesheet" href="dist/styles/iview.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/login.css">
    <script src="js/config.js"></script>
    <style>
         html,body,#dsm-wraper{width: 100%;height: 100%;}
         div.content-box{position:absolute;left: 0;right: 0;top: 0;bottom: 260px;}
         div.table-wrapper{position:absolute;left: 0;right: 0;bottom: 0;height: 260px;}
         #dsm-wraper .ivu-tabs-bar{margin-bottom: 0;}
        /* content-box start*/
        div.content-box>div{float: left;height: 100%;width: 30%;}
        #video-wrapper{width: 40%}
        /* content-box end */
    </style>
</head>
<body>
    <div id="dsm-wraper">
        <div class="content-box">
            <div>
                <div id="map" style="width:100%;height:100%;"></div>
            </div>
            <div id="video-wrapper"></div>
            <div>
                <i-table border 
                    :columns="alarmSummaryColumns"
                    :data="tableData"
                    :height="tableHeight"></i-table>   
            </div>
        </div>
        <div class="table-wrapper">
            <Tabs value="" :animated="false">
                <Tab-Pane label="前向报警" name="forwardAlarm">
                    <i-table border 
                        :columns="alarmSummaryColumns"
                        :data="tableData" height="223"></i-table>   
                </Tab-Pane>
                <Tab-Pane label="驾驶异常" name="abnormalDriving">
                    <i-table border 
                        :columns="alarmSummaryColumns"
                        :data="tableData" height="223"></i-table>   
                </Tab-Pane>
            </Tabs>
        </div>
    </div>
    <script src="dist/vue.min.js"></script>
    <script src="js/js.cookie.min.js"></script>
    <script src="dist/iview.min.js"></script>
    <script src="js/gps51-jquery.js"></script>
    <script src="js/config.js"></script>
    <script src="js/util.js"></script>
    <script src="js/dateformat.js"></script>
    <script src="https://api.map.baidu.com/api?v=3.0&ak=e7SC5rvmn2FsRNE4R1ygg44n"></script>
    <script type="text/javascript">
        var deviceid = utils.getParameterByName("deviceid");
        var token = utils.getParameterByName("token");
        var vRoot = new Vue({
            el:'#dsm-wraper',
            data:{
                tableHeight:100,
                columns:[
                    { title:"通道21" , key:"cskj4d" },
                    { title:"通道" , key:"cskj4d" },
                    { title:"通道3" , key:"cskj4d" },
                    { title:"通道4" , key:"cs4kjd" }
                ],
                alarmSummaryColumns:[
                    { title:"车牌号" , key:"carid" },
                    { title:"报警类型" , key:"alarmtype" },
                    { title:"等级" , key:"grade" },
                    { title:"报警时间" , key:"alarmtime" }
                ],
                tableData:[{carid:"11",alarmtype:'alarmtypealarmtype',grade:'1',alarmtime:'2018-12-12'}],
            },
            map:null,
            methods: {
                initMap : function(){
                    var self = this;
                    this.map = new BMap.Map("map",{minZoom:4,maxZoom:20});           
                    this.map.enableScrollWheelZoom();
                    this.map.enableAutoResize();
                    this.map.disableDoubleClickZoom();
                    this.map.centerAndZoom(new BMap.Point(108.0017245, 35.926895), 5)
                    this.map.addControl(new BMap.CityListControl({anchor: BMAP_ANCHOR_TOP_LEFT,offset: new BMap.Size(10, 20),}));
                },
                getTableHeight:function(){
                    var wHeight = document.documentElement.clientHeight || document.body.clientHeight ;
                    return wHeight - 260;
                },
                queryActiveSafety:function() {
                    var url = myUrls.queryActiveSafetyTrack();
                    var data = {
                        deviceid:deviceid,
                        begintime:DateFormat.format(new Date(),'yyyy-MM-dd')+' 00:00:00',
                        endtime:DateFormat.format(new Date(),'yyyy-MM-dd')+' 23:59:59',
                        timezone : 8
                    };
                    utils.sendAjax(url,data,function (resp) { 
                        console.log('resp',resp );
                    })
                },
                initApp:function(){
                    this.initMap();
                    this.tableHeight = this.getTableHeight();
                    this.queryActiveSafety();
                }
            },
            mounted :function() {
                this.initApp();
            },
        })

        // `activesafetyid`  int(11) NOT NULL AUTO_INCREMENT ,
        // `deviceid`  varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT '设备id' ,
        // `alarmtype`  int(11) NULL DEFAULT 0 COMMENT '报警类型0x64 高级驾驶辅助系统报警信息 0x65 驾驶员状态监测系统报警信息 0x66 胎压监测系统报警信息 0x67 盲区监测系统报警信息' ,
        // `alarmid`  int(11) NULL DEFAULT 0 COMMENT '按照报警先后，从 0 开始循环累加，不区分报警类型。' ,
        // `statusflag`  int(11) NULL DEFAULT 0 COMMENT '标志状态 0x00：不可用\r\n0x01：开始标志\r\n0x02：结束标志' ,
        // `alarmevent`  int(255) NULL DEFAULT 0 COMMENT '报警/事件类型\r\n0x01:疲劳驾驶报警\r\n0x02:接打电话报警\r\n0x03:抽烟报警 \nT/JSATL 12—2017\r\n14\r\n0x04:分神驾驶报警\r\n0x05:驾驶员异常报警\r\n0x06~0x0F：用户自定义\r\n0x10：自动抓拍事件\r\n0x11：驾驶员变更事件\r\n0x12~0x1F：用户自定义' ,
        // `alarmlevel`  int(11) NULL DEFAULT 0 COMMENT '报警级别\r\n0x01：一级报警\r\n0x02：二级报警' ,
        // `tiredlevel`  int(11) NULL DEFAULT 0 COMMENT '疲劳程度 BYTE 范围 1~10。数值越大表示疲劳程度越严重，仅在报警\r\n类型为 0x01 时有效' ,
        // `speed`  int(11) NULL DEFAULT 0 COMMENT '车速 单位 Km/h。范围 0~250 ' ,
        // `altitude`  double NULL DEFAULT 0 COMMENT '海拔高度，单位为米（m） ' ,
        // `lat`  double NULL DEFAULT 0 COMMENT '计算出来的纬度' ,
        // `lon`  double NULL DEFAULT 0 COMMENT '计算出来的经度' ,
        // `carstatus`  int(11) NULL DEFAULT 0 COMMENT '车辆 状态' ,
        // `alarmflag`  int(11) NULL DEFAULT 0 COMMENT '报警标识号' ,
        // `arrivedtime`  bigint(20) NULL DEFAULT 0 COMMENT '服务器时间' ,
        // `devicetime`  bigint(20) NULL DEFAULT 0 COMMENT '设备时间' ,
        // `updatetime`  bigint(20) NULL DEFAULT NULL COMMENT '更新时间' ,

    </script>
</body>
</html>
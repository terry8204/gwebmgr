<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="./favicon.ico" />
    <title>汽车视频平台</title>
    <link rel="stylesheet" href="dist/styles/iview.css">
    <link rel="stylesheet" href="./videojs/bin.css">
    <style>
        html,body,#container,.full{
            width: 100%;
            height: 100%;  
            position: relative;
            overflow: hidden;
        }
        .col-cls{
            text-align: center;
            line-height: 32px;
        }
        .row-cls{
            margin-bottom: 10px;
        }
        video{
            object-fit: fill;
            width: 100%;
            height: 100%;
        }
        #videoContent{
            overflow: hidden;
            position: absolute;
            left: 0px;
            right:  0px;
            top:  0px;
            bottom:  0px;
        }
        #videoContent > div{
            float: left;
            overflow: hidden;
        }
        .layui-elem-field {
            margin-bottom: 10px;
            padding: 0;
            border-width: 1px;
            border-style: solid;
        }
        fieldset {
            display: block;
            margin-inline-start: 2px;
            margin-inline-end: 2px;
            padding-block-start: 0.35em;
            padding-inline-start: 0.75em;
            padding-inline-end: 0.75em;
            padding-block-end: 0.625em;
            min-inline-size: min-content;
            border-width: 2px;
            border-style: groove;
            border-color: threedface;
            border-image: initial;
        }
        #videoContent .vjs-picture-in-picture-control{
            display: none;
        }

        .videoContent-1>div:first-child{
            width: 100%;
            height: 100%;
        }
        .videoContent-4>div{
            width: 50%;
            height: 50%;
        }

        .videoContent-6>div:first-child{
            width: 66.66%;
            height: 66.655%;
        }
        .videoContent-6>div{
            width: 33.33%;
            height: 33.33333% ;
        }

        .videoContent-8>div:first-child{
            width: 75%;
            height: 75%;
        }
        .videoContent-8>div{
            width: 25%;
            height: 25%;
        }

        .videoContent-9>div{
            width: 33.33%;
            height: 33.33%;
        }

        .videoContent-16>div{
            width: 25%;
            height: 25%;
        }

    </style>
    <link href="./videojs/video-js.css" rel="stylesheet">
    <script src="./videojs/video.js"></script>
    <script src="./videojs/videojs-flash.min.js"></script>

</head>
<body>
    <div id="container">
        <Spin fix style="z-index:9999;" v-show="Spin">查询中,请稍后...</Spin> 
        <Layout class="full">
            <i-Header>
                <Row style="height: 100%;">   
                    <i-Col span="12" style="height: 100%;color: #ffffff">
                        <h1 style="color:#ffffff">汽车视频平台-视频监控</h1>
                    </i-Col>
                </Row> 
            </i-Header>
            <Layout class="full" style="position: relative;">
                <Sider hide-trigger width="300" style="background-color:#ffffff;padding:10px;">
                    <div class="full">
                       
                    </div>
                </Sider>
                <div style="position: absolute; left: 300px;bottom: 0;right: 0;top: 0;">
                  
                                <div style="background-color: #eee;height:45px;line-height:45px;padding: 0 10px; position: absolute;left: 0;right: 0;top: 0;">
                                    <Row style="height: 100%;">   
                                        <i-Col span="12" style="height: 100%;color: #ffffff">
                                            <i-button type="primary" @click="handleStartAllVideos" size="small">开始</i-button>
                                            <i-button type="success" @click="handleStopAllVideos" size="small">结束</i-button>
                                            <i-button type="success" @click="handleFullScreen" size="small">全屏显示</i-button>
                                            <i-button type="success" @click="queryVideoProperty" size="small">参数查询</i-button>
                                            <Modal v-model="videoPropertyModal" width="500">
                                                    <p slot="header" style="color:#f60;text-align:center">
                                                        <Icon type="ios-create-outline"></Icon>
                                                        <span>视频参数</span>
                                                    </p>
                                                    <div style="text-align:center">
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频编码方式 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiocodec}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频编码方式字符 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiocodecstr}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频声道数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiosamplerate}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频采样位数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiosamplebits}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频帧长度 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audioframelength}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">是否支持音频输出 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiooutputsupport}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">视频编码方式 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.videocodec}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">视频编码方式字符 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.videocodecstr}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">终端支持最大音频物理通道数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiomaxsupport}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">终端支持最大视频物理通道数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.videomaxsupport}}
                                                            </i-Col>
                                                        </Row>
                                                    </div>
                                                    <div slot="footer">
                                                        <i-button type="primary"  @click="videoPropertyModal=false" style="width: 100%">确定</i-button>
                                                    </div>
                                                </Modal> 
                                                <Modal v-model="setupModal" width="800">
                                                    <Tabs value="" :animated="false">
                                                        <Tab-Pane label="音视频参数" name="videoSetup">
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="24" style="height: 100%;line-height:32px;text-align: right;">
                                                                    <i-button type="info" @click="queryClientParameters">查询</i-button>
                                                                    <i-button type="primary" @click="setClientParameters">发送</i-button>
                                                                </i-Col>
                                                            </Row>   
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    实时流编码模式 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <i-select v-model="realtimebitratemode">
                                                                        <i-option value="0">CBR(固定码率)</i-option>
                                                                        <i-option value="1">VBR(可变码率)</i-option>
                                                                        <i-option value="2">ABR(平均码率)</i-option>
                                                                    </i-select>
                                                                </i-Col>
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    存储流编码模式 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <i-select v-model="storebitratemode">
                                                                        <i-option value="0">CBR(固定码率)</i-option>
                                                                        <i-option value="1">VBR(可变码率)</i-option>
                                                                        <i-option value="2">ABR(平均码率)</i-option>
                                                                    </i-select>
                                                                </i-Col>
                                                            </Row>   
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    实时流分辨率 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <i-select v-model="realtimeresolution">
                                                                        <i-option value="0">QCIF</i-option>
                                                                        <i-option value="1">CIF</i-option>
                                                                        <i-option value="2">WCIF</i-option>
                                                                        <i-option value="3">D1</i-option>
                                                                        <i-option value="4">WD1</i-option>
                                                                        <i-option value="5">720p</i-option>
                                                                        <i-option value="6">1080p</i-option>
                                                                    </i-select>
                                                                </i-Col>
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    存储流分辨率 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <i-select v-model="storeresolution">
                                                                        <i-option value="0">QCIF</i-option>
                                                                        <i-option value="1">CIF</i-option>
                                                                        <i-option value="2">WCIF</i-option>
                                                                        <i-option value="3">D1</i-option>
                                                                        <i-option value="4">WD1</i-option>
                                                                        <i-option value="5">720p</i-option>
                                                                        <i-option value="6">1080p</i-option>
                                                                    </i-select>
                                                                </i-Col>
                                                            </Row>   
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    实时流关键帧间隔 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <Input-Number :max="1000" :min="1" v-model="realtimekeyframeinterval"></Input-Number>
                                                                    范围1~1000
                                                                </i-Col>
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    存储流关键帧间隔 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <Input-Number :max="1000" :min="1" v-model="storekeyframeinterval"></Input-Number>
                                                                    范围1~1000
                                                                </i-Col>
                                                            </Row>   
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    实时流目标帧率 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <Input-Number :max="120" :min="1" v-model="realtimeframerate"></Input-Number>
                                                                    范围1~120 帧/秒
                                                                </i-Col>
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    存储流目标帧率 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <Input-Number :max="120" :min="1" v-model="storeframerate"></Input-Number>
                                                                    范围1~120 帧/秒
                                                                </i-Col>
                                                            </Row>   
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    实时流目标码率 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <Input-Number :max="1000" :min="1" v-model="realtimeframebitrate"></Input-Number>
                                                                    kbps
                                                                </i-Col>
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    存储流目标码率 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <Input-Number :max="1000" :min="1" v-model="storeframebitrate"></Input-Number>
                                                                    kbps
                                                                </i-Col>
                                                            </Row> 
                                                            <hr/>  
                                                            <fieldset class="layui-elem-field fieldset" style="margin-top:5px;padding-left: 10px;">
                                                                <legend style="margin-left:20px;">OSD 字幕叠加设置</legend>
                                                                <Row style="height:32px;margin: 10px 0;">
                                                                    <i-Col span="24" style="height: 100%;line-height:32px;">
                                                                        <checkbox-group v-model="videoCheckboxGroup">
                                                                            <Checkbox label="dateandtime">
                                                                                <span>日期和时间</span>
                                                                            </Checkbox>
                                                                            <Checkbox label="carnum">
                                                                                <span>车牌号码</span>
                                                                            </Checkbox>
                                                                            <Checkbox label="channel">
                                                                                <span>逻辑通道号</span>     
                                                                            </Checkbox>
                                                                            <Checkbox label="latlon">
                                                                                <span>经纬度</span>   
                                                                            </Checkbox>
                                                                            <Checkbox label="recorderspeed">
                                                                                <span>行驶记录速度</span>
                                                                            </Checkbox>
                                                                            <Checkbox label="gpsspeed">
                                                                                <span>卫星定位速度</span>
                                                                            </Checkbox>
                                                                            <Checkbox label="drivingtime">
                                                                                <span>连续驾驶时间</span>
                                                                            </Checkbox>
                                                                        </checkbox-group>
                                                                    </i-Col>
                                                                </Row> 
                                                            </fieldset>
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    是否启用音频输出 :
                                                                </i-Col>
                                                                <i-Col span="7" style="height: 100%;line-height:32px;">
                                                                    <i-select placement="top" v-model="usingaudio">
                                                                        <i-option value="1">启用</i-option>
                                                                        <i-option value="0">不启用</i-option>
                                                                    </i-select>
                                                                </i-Col>
                                                            </Row>
                                                        </Tab-Pane>
                                                        <Tab-Pane label="视频播放参数" name="name2">
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    播放帧率 :
                                                                </i-Col>
                                                                <i-Col span="12" style="height: 100%;line-height:32px;">
                                                                    <i-input v-model="videoplayframerate" style="width:300px"></i-input>
                                                                    帧/秒
                                                                </i-Col>
                                
                                                            </Row>
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="5" style="height: 100%;line-height:32px;text-align: center;">
                                                                    传输模式 :
                                                                </i-Col>
                                                                <i-Col span="12" style="height: 100%;line-height:32px;">
                                                                    <i-select placement="top" v-model="videotranstype" style="width:300px">
                                                                        <i-option value="0">TCP</i-option>
                                                                        <i-option value="1">UTP</i-option>
                                                                    </i-select>
                                                                </i-Col>
                                                            </Row>
                                                            <Row style="height:32px;margin: 10px 0;">
                                                                <i-Col span="17" style="height: 100%;line-height:32px;text-align: center;">
                                                                    <i-button type='primary' @click='handleSetPlayParamter'>设置播放视频参数</i-button>
                                                                </i-Col>
                                                            </Row>
                                                        </Tab-Pane>
                                                    </Tabs>
                                                    <div slot="footer" style="padding:10px;"></div>
                                                </Modal>     
                                        </i-Col>
                                        <i-Col span="12" style="height: 100%;text-align: right;" class="tv_box">
                                            <span><i class="icon icon_num1" @click="openAndCloseVideoWindows(1)"></i></span>
                                            <span><i class="icon icon_num2" @click="openAndCloseVideoWindows(4)"></i></span>
                                            <span><i class="icon icon_num3" @click="openAndCloseVideoWindows(6)"></i></span>
                                            <span><i class="icon icon_num4" @click="openAndCloseVideoWindows(8)"></i></span>
                                            <span><i class="icon icon_num5" @click="openAndCloseVideoWindows(9)"></i></span>
                                            <span><i class="icon icon_num6" @click="openAndCloseVideoWindows(16)"></i></span>
                                            <span id="box_stop">
                                                <i class="icon icon_close_show"></i><i class="icon icon_xl"></i>
                                                <ul class="tc_box" style="display: none;">
                                                    <li><a id="stopAll" href="#"><i class="icon icon_gou"></i>停止所有视频</a></li>
                                                    <li><a id="clearAll" href="#"><i class="icon icon_gou"></i>清除所有视频</a></li>
                                                </ul>
                                            </span>
                                            <span @click="setupModal=true"><i class="icon icon_num9"></i></span>
                                        </i-Col>
                                    </Row> 
                                </div>
                                <div style="position: absolute;left: 0;right: 0;top: 45px;bottom: 0;padding: 10px">
                                    <div class="full">
                                        <div :class="videoContentCls" id="videoContent" ref="videoContent" class="full">
                                            <!-- <div v-for="(item , index) in videoNumber" :key="index">
                                                <video :id="'video'+index" class="video-js" controls poster="" >  
                                            </div> -->
                                        </div>                                 
                                    </div>
                                </div>    
                         

                        
                </div>
            </Layout>   
        </Layout>   
    </div>
    <script src="js/polyfill.min.js"></script>
    <script src="dist/vue.min.js"></script>
    <script src="dist/iview.min.js"></script>
    <script src="js/gps51-jquery.js"></script>
    <script src="js/config.js"></script>
    <script src="js/dateformat.js"></script>
    <script src="js/js.cookie.min.js"></script>
    <script src="js/util.js"></script>

    <script>
        var deviceid = utils.getParameterByName("deviceid");
        var token = utils.getParameterByName("token");

        var vRoot = new Vue({
            el:"#container",
            data:{
                activeMenuItem:'video',
                videoContentWH:{
                    width:0,
                    height:0
                },

                videoProperty:{},
                setupModal:false,
                videoPropertyModal:false,
                isFullScreen:false,
                videoNumber:4,
                videoIns:{}, // videojs 实例
                Spin:false,
                allPlayUrls:[],
                videoTimes:{},

                // 音视频参数设置
                realtimebitratemode:'',
                storebitratemode:'',
                realtimeresolution:'',
                storeresolution:'',
                realtimekeyframeinterval:'',
                storekeyframeinterval:'',
                realtimeframerate:'',
                storeframerate:'',
                realtimeframebitrate:'',
                storeframebitrate:'',
                videoCheckboxGroup:[],
                usingaudio:'',

                // 视频播放参数
                videoplayframerate:'',
                videotranstype:'',

            },
            methods: {
                queryClientParameters:function(){
                    var url = myUrls.queryClientParameters() , me = this;
                    utils.sendAjax(url,{deviceid:deviceid},function (data) { 
                        if(data.status === 6){
                            var videoCheckboxGroup = [];
                            var audiovideoparameters = data.audiovideoparameters;
                            me.realtimebitratemode = audiovideoparameters.realtimebitratemode +''; 
                            me.storebitratemode = audiovideoparameters.storebitratemode+'';
                            me.realtimeresolution = audiovideoparameters.realtimeresolution+'';
                            me.storeresolution = audiovideoparameters.storeresolution+'';
                            me.realtimekeyframeinterval = audiovideoparameters.realtimekeyframeinterval;
                            me.storekeyframeinterval = audiovideoparameters.storekeyframeinterval;
                            me.realtimeframerate = audiovideoparameters.realtimeframerate;
                            me.storeframerate = audiovideoparameters.storeframerate;
                            me.realtimeframebitrate = audiovideoparameters.realtimeframebitrate;
                            me.storeframebitrate = audiovideoparameters.storeframebitrate;
                            me.usingaudio = audiovideoparameters.usingaudio+'';
                            audiovideoparameters.carnum ? videoCheckboxGroup.push('carnum') : null;
                            audiovideoparameters.channel ? videoCheckboxGroup.push('channel') : null;
                            audiovideoparameters.dateandtime ? videoCheckboxGroup.push('dateandtime') : null;
                            audiovideoparameters.drivingtime ? videoCheckboxGroup.push('drivingtime') : null;
                            audiovideoparameters.gpsspeed ? videoCheckboxGroup.push('gpsspeed') : null;
                            audiovideoparameters.latlon ? videoCheckboxGroup.push('latlon') : null;
                            me.videoCheckboxGroup = videoCheckboxGroup;
                            console.log('audiovideoparameters', audiovideoparameters);     
                        }else{
                            me.$Message.error("查询失败");
                        }
                    });
                },
                setClientParameters:function () { 
                    var parameters = {};
                    if(
                        this.realtimebitratemode &&
                        this.storebitratemode &&
                        this.realtimeresolution &&
                        this.storeresolution &&
                        this.realtimekeyframeinterval &&
                        this.storekeyframeinterval &&
                        this.realtimeframerate &&
                        this.realtimeframebitrate &&
                        this.storeframebitrate &&
                        this.usingaudio !== '' 
                    ){
                    
                        parameters.realtimebitratemode = Number(this.realtimebitratemode);
                        parameters.storebitratemode = Number(this.storebitratemode);
                        parameters.realtimeresolution = Number(this.realtimeresolution);
                        parameters.storeresolution = Number(this.storeresolution);
                        parameters.realtimekeyframeinterval = this.realtimekeyframeinterval;
                        parameters.storekeyframeinterval = this.storekeyframeinterval;
                        parameters.realtimeframerate = this.realtimeframerate;
                        parameters.realtimeframebitrate = this.realtimeframebitrate;
                        parameters.storeframebitrate = this.storeframebitrate;
                        parameters.usingaudio = Number(this.usingaudio);

                        var options = ['dateandtime','carnum','channel','latlon','recorderspeed','gpsspeed','drivingtime'];
                        var videoCheckboxGroup = this.videoCheckboxGroup;
                        var url = myUrls.setAudioVideoParameters_Sync() , me = this;
                        options.forEach(function (item) { 
                            if(videoCheckboxGroup.indexOf(item)!=-1){
                                parameters[item] = true;
                            }else{
                                parameters[item] = false;
                            }  
                        })
                        parameters.deviceid = deviceid;
                        utils.sendAjax(url,parameters,function (resp) { 
                            if(resp.status === 0){
                                me.$Message.success("成功");
                            }else if(resp.status === 1){

                            }else if(resp.status === 2){

                            }else if(resp.status === 3){

                            }else if(resp.status === 4){

                            }else if(resp.status === 5){

                            }else if(resp.status === 6){

                            }else if(resp.status === 6){

                            }else if(resp.status === 7){

                            }else if(resp.status === 8){
                                me.$Message.error("超时");
                            }
                        })
                    }else{
                        this.$Message.error("请填写全部参数")
                    }
                    
                },
                queryVideoProperty:function(){
                    this.Spin = true;
                    var url = myUrls.queryVideoProperty(), that = this;
                    utils.sendAjax(url,{deviceid:deviceid},function (data) { 
                        var status = data.status ;
                        if(status === 0 ){
                            that.$Message.success("查询成功");  
                            that.videoProperty = data;
                            that.videoPropertyModal = true;
                        }else if(status === 1){
                            that.$Message.error();
                        }else if(status === 2){
                            that.$Message.error("设备不在线");   
                        }else if(status === 3){
        
                        }else if(status === 4){

                        }else if(status === 5){
                            that.$Message.error("错误:" + data.cause);
                        }
                        that.Spin = false;
                    })
                },
                handleStartAllVideos:function(){
                    var url = myUrls.startVideos() , me = this;
                    utils.sendAjax(url,{deviceid:deviceid, channels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},function (resp) {
                        var records = resp.records , status = resp.status ;
                        if(status === 0 && records.length){
                            me.$Message.success("全部开始成功")
                            for(var i = 0 ; i < me.videoIns.length;i++){
                                var player = me.videoIns[i];
                                    player.play();
                            }
                        }else if(status === 1){
                            me.$Message.error();
                        }else if(status === 2){
                            me.$Message.error("设备不在线");   
                        }else if(status === 3){
        
                        }else if(status === 4){

                        }else if(status === 5){
                            me.$Message.error("错误:" + resp.cause);
                        }
                    })    
                },
                handleStopAllVideos:function(){
                    var url = myUrls.stopVideos() , me = this;
                    utils.sendAjax(url,{deviceid:deviceid, channels:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},function (resp) {
                        var records = resp.records , status = resp.status ;
                        if(status === 0 && records.length){
                                
                        }
                        me.$Message.success("停止全部成功");
                        for(var i = 0 ; i < me.videoIns.length;i++){
                            var player = me.videoIns[i];
                                player.pause();
                        }
                    })
                },
                handleStartVideos:function(index){
                    var url = myUrls.startVideos() , me = this;
                    utils.sendAjax(url,{deviceid:deviceid, channels:[Number(index)+1]},function (resp) {
                        var records = resp.records , status = resp.status ;
                        if(status === 0 && records.length){
                            // me.$Message.success("开始成功")
                                var player = me.videoIns[index];
                                player.play();
                        }else if(status === 1){
                            me.$Message.error();
                        }else if(status === 2){
                            me.$Message.error("设备不在线");   
                        }else if(status === 3){
        
                        }else if(status === 4){

                        }else if(status === 5){
                            me.$Message.error("错误:" + resp.cause);
                        }
                    })
                },
                handleStopVideos:function(index){
                    var url = myUrls.stopVideos() , me = this;
                    utils.sendAjax(url,{deviceid:deviceid, channels:[Number(index)+1],videoclosetype:0},function (resp) {
                        if(resp.status === 0){
                            // me.$Message.success("停止成功")
                            // me.videoIns.forEach(function (item) {
                            //     item.pause();
                            // });
                        }else if(status === 1){

                        }else if(status === 2){
                            me.$Message.error("设备不在线");   
                        }else if(status === 3){
        
                        }else if(status === 4){

                        }else if(status === 5){
                            me.$Message.error("错误:" + resp.cause);
                        }
                    })
                },
                handleFullScreen:function(){
                    var main = this.$refs.videoContent;
                    if (this.isFullScreen) {
                        if (document.exitFullscreen) {
                        document.exitFullscreen()
                        } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen()
                        } else if (document.webkitCancelFullScreen) {
                        document.webkitCancelFullScreen()
                        } else if (document.msExitFullscreen) {
                        document.msExitFullscreen()
                        }
                    } else {
                        if (main.requestFullscreen) {
                        main.requestFullscreen()
                        } else if (main.mozRequestFullScreen) {
                        main.mozRequestFullScreen()
                        } else if (main.webkitRequestFullScreen) {
                        main.webkitRequestFullScreen()
                        } else if (main.msRequestFullscreen) {
                        main.msRequestFullscreen()
                        }
                    }
                    this.isFullScreen = false;
                },
                displayAndHideVideos:function(toOpensIndex){
                    var wrapper = document.getElementById('videoContent').children;  
                    for(var i = 0 ; i < 16 ;i++){
                        var player =this.videoIns[i];
                        if(i < toOpensIndex)
                        {
                            // if(player.paused())
                            // {
                            //     player.play();
                            // }
                            // wrapper[i].style.display = 'block';
                        }
                        else
                        {
                            player && player.pause();
                            // wrapper[i].style.display = 'none';
                        }                         
                    }
                },
                openAndCloseVideoWindows:function(toOpensIndex){

                    var oldVal = this.videoNumber;
                    var newVal = toOpensIndex;
                    this.videoNumber = toOpensIndex;
                    document.getElementById('videoContent').className = 'videoContent-' + this.videoNumber;     

                    // setTimeout(()=>{
                        for(var i = 0 ; i < toOpensIndex; i++){
                            var player = this.videoIns[i];
                            if(player){
                                var wrapper = document.getElementById('videoContent').children[i]; 
                                !player.src && player.src(this.allPlayUrls[i].playurl);
                                player.height($(wrapper).height());
                                player.width($(wrapper).width());
                                console.log('height',$(wrapper).height())
                                console.log('width',$(wrapper).width())
                            }else{
                                console.log('i', i);
                                this.initVideo(i);
                            }
                        }
                    // },100)
              
                },
                createVideoElement:function(index){
                    var div = document.createElement('div');
                    var videoEl = document.createElement('video');
                        videoEl.setAttribute( 'id' , 'video' + index );
                        videoEl.setAttribute( 'controls' , 'true' );
                        videoEl.setAttribute( 'poster' , '');
                        videoEl.className ="video-js";
                        div.appendChild(videoEl);
                        document.getElementById('videoContent').appendChild(div);
                },
                initVideo:function(index){
                        var self = this;
                        this.createVideoElement(index);
                        var wrapper = document.getElementById('videoContent').children[index]; 

                        var player = videojs('video'+index , {
                            autoplay: false ,
                            preload:false,
                            height:$(wrapper).height(),
                            width:$(wrapper).width(),
                            controlBar: {
                                remainingTimeDisplay:false,
                                progressControl: false,
                                liveDisplay: true,
                            },
                            techOrder: ['html5','flash'],
                            sources: [
                                    // { 
                                        // src: 'rtmp://58.200.131.2:1935/livetv/hunantv',
                                        // src:this.allPlayUrls[index].playurl,
                                        // type: 'rtmp/flv'
                                    // }
                                ],
                        },function(){
                            this.on('play',function () { 
                                document.getElementsByClassName('vjs-big-play-button')[index].style.display = 'none';
                                self.handleStartVideos(index);
                                self.videoTimes['videoPlayer'+(index)] = Date.now();
                            });
                            this.on('pause',function () { 
                                document.getElementsByClassName('vjs-big-play-button')[index].style.display = 'block';
                                self.handleStopVideos(index);
                                delete self.videoTimes['videoPlayer'+(index)];
                            });
                            // this.src(self.allPlayUrls[index].playurl);
                            // console.log('type', this.type)
                        });
                        this.videoIns[index] = player;
                },
                initApp:function(){
                    var videoContent = this.$refs.videoContent;
                    this.videoContentWH = videoContent.getBoundingClientRect();
                    for(var i = 0 ; i < this.videoNumber ; i++){
                        this.initVideo(i);
                    }


                },
                queryVideosPlayUrl:function(callback){
                    var url = myUrls.queryVideosPlayUrl() ,me = this;
                    utils.sendAjax(url,{deviceid:deviceid},function (data) { 
                        if(data.status === 0){
                            me.allPlayUrls = data.records;
                            me.allPlayUrls.forEach(function (item,index) { 
                                if(index<me.videoNumber){
                                    me.videoIns[index].src(item.playurl);
                                }
                            })
                            callback(data)
                        }else if(data.status === 3){

                        }
                    });
                },
                stopVideoPlayer(){
                    var videoIns = this.videoIns;
                    for(var i = 0 ; i < videoIns.length;i++){
                        var key = 'videoPlayer'+i;
                        var nowTime = Date.now();
                        var oldTime = this.videoTimes[key];
                        if(oldTime){
                            if((nowTime - oldTime) > 1000*60*5){
                                var player = videoIns[i];
                                player.pause();
                                delete this.videoTimes[key];
                            }
                        }
                    }
                },
                checkVideoPlayerTime(){
                    this.myInterval = setInterval(()=>{
                        this.stopVideoPlayer();
                    },5000);
                },
                queryDeviceById:function(){
                    var url = myUrls.queryDeviceById() , that = this;
                    utils.sendAjax(url,{deviceid:deviceid},function (data) { 
                        if(data.status == 0){
                            that.videoplayframerate = data.device.videoplayframerate ;
                            that.videotranstype = data.device.videotranstype + '';
                        }else{}
                    })
                },
                handleSetPlayParamter:function(){
                    var url = myUrls.setVideoPlayParameters() , that = this;
                    if(!isNaN(this.videoplayframerate) && Number(this.videoplayframerate) >= 0){
                        var data = {
                            deviceid:deviceid,
                            videoplayframerate:Number(this.videoplayframerate),
                            videotranstype:Number(this.videotranstype),
                        }

                        utils.sendAjax(url,data,function (data) { 

                            if(data.status === 0){
                                that.$Message.success('设置成功')
                            }else{
                                that.$Message.error('设置失败')
                            }

                        })

                    }else{
                        that.$Message.error('请正确填写帧率')
                    }
                }
            },
            computed:{
               videoContentCls:function(){
                   return {
                    //    'videoContent-1':this.videoNumber === 1,
                    //    'videoContent-4':this.videoNumber === 4,
                    //    'videoContent-6':this.videoNumber === 6,
                    //    'videoContent-8':this.videoNumber === 8,
                    //    'videoContent-9':this.videoNumber === 9,
                    //    'videoContent-16':this.videoNumber === 16,
                    //    'full':true
                   }
               }
            },
            watch: {
                // videoNumber:function(newVal,oldVal){
                    
                // }
            },
            mounted :function() {
                var that = this; 
                // videojs.options.flash.swf = "./videojs/video-js.5.4.2.swf";
                this.$nextTick(function(){ 
                    document.getElementById('videoContent').className = 'videoContent-4';
                    that.initApp(); 
                    
                    window.onresize = function (){
                        for(var i = 0 ; i < that.videoNumber; i++){
                            var player = that.videoIns[i];
                            if(player){
                                var wrapper = document.getElementById('videoContent').children[i]; 
                                !player.src && player.src(that.allPlayUrls[i].playurl);
                                player.height($(wrapper).height());
                                player.width($(wrapper).width());
                            }
                        }
                    }

                    that.checkVideoPlayerTime();

                    that.queryVideosPlayUrl(function (data) {});

                    that.queryDeviceById();
                });

            },
        })
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="./favicon.ico" />
    <title>汽车视频平台</title>
    <link rel="stylesheet" href="dist/styles/iview.css">
    <link rel="stylesheet" href="./videojs/bin.css">
    <style>
        html,body,#container,.full{
            width: 100%;
            height: 100%;  
            position: relative;
            overflow: hidden;
        }
        .col-cls{
            text-align: center;
            line-height: 32px;
        }
        .row-cls{
            margin-bottom: 10px;
        }
        video{
            object-fit: fill;
            width: 100%;
            height: 100%;
        }
        #videoContent{
            overflow: hidden;
            position: absolute;
            left: 0px;
            right:  10px;
            top:  0px;
            bottom:  10px;
        }
        #videoContent > div{
            float: left;
        }
    </style>
    <link href="./videojs/video-js.css" rel="stylesheet">
    <script src="./videojs/video.js"></script>
    <script src="./videojs/videojs-flash.min.js"></script>
</head>
<body>
    <div id="container">
        <Spin fix style="z-index:9999;" v-show="Spin">查询中,请稍后...</Spin> 
        <Layout style="height:100%;">
            <i-Header>
                <Row style="height: 100%;">   
                    <i-Col span="12" style="height: 100%;color: #ffffff">
                        <h1 style="color:#ffffff">汽车视频平台-视频监控</h1>
                    </i-Col>
                </Row> 
            </i-Header>
            <Layout>
                <Sider hide-trigger width="300" style="background-color:#ffffff;padding:10px;">
                    <div class="full">
                       1212
                    </div>
                </Sider>
                <i-Content>
                        <Layout class="full">
                            <Layout class="full">
                                <i-Header style="background-color: #eee;height:45px;line-height:45px;padding: 0 10px;">
                                    <Row style="height: 100%;">   
                                        <i-Col span="12" style="height: 100%;color: #ffffff">
                                            <i-button type="primary" @click="handleStartVideos" size="small">开始</i-button>
                                            <i-button type="success" @click="handleStopVideos" size="small">结束</i-button>
                                            <i-button type="success" @click="handleFullScreen" size="small">全屏显示</i-button>
                                            <i-button type="success" @click="queryVideoProperty" size="small">参数查询</i-button>
                                            <Modal v-model="videoPropertyModal" width="500">
                                                    <p slot="header" style="color:#f60;text-align:center">
                                                        <Icon type="ios-create-outline"></Icon>
                                                        <span>视频参数</span>
                                                    </p>
                                                    <div style="text-align:center">
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频编码方式 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiocodec}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频编码方式字符 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiocodecstr}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频声道数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiosamplerate}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频采样位数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiosamplebits}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">音频帧长度 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audioframelength}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">是否支持音频输出 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiooutputsupport}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">视频编码方式 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.videocodec}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">视频编码方式字符 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.videocodecstr}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">终端支持最大音频物理通道数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.audiomaxsupport}}
                                                            </i-Col>
                                                        </Row>
                                                        <Row style="height:32px;">
                                                            <i-Col span="8" style="height: 100%;text-align:right;line-height:32px;">终端支持最大视频物理通道数 : &nbsp;</i-Col>
                                                            <i-Col span="16" style="height: 100%;line-height:32px;">
                                                                {{videoProperty.videomaxsupport}}
                                                            </i-Col>
                                                        </Row>
                                                    </div>
                                                    <div slot="footer">
                                                        <i-button type="primary"  @click="videoPropertyModal=false" style="width: 100%">确定</i-button>
                                                    </div>
                                                </Modal>   
                                        </i-Col>
                                        <i-Col span="12" style="height: 100%;text-align: right;" class="tv_box">
                                            <span><i class="icon icon_num1" @click="openAndCloseVideoWindows(1)"></i></span>
                                            <span><i class="icon icon_num2" @click="openAndCloseVideoWindows(4)"></i></span>
                                            <span><i class="icon icon_num3" @click="openAndCloseVideoWindows(6)"></i></span>
                                            <span><i class="icon icon_num4" @click="openAndCloseVideoWindows(8)"></i></span>
                                            <span><i class="icon icon_num5" @click="openAndCloseVideoWindows(9)"></i></span>
                                            <span><i class="icon icon_num6" @click="openAndCloseVideoWindows(16)"></i></span>
                                            <span id="box_stop">
                                                <i class="icon icon_close_show"></i><i class="icon icon_xl"></i>
                                                <ul class="tc_box" style="display: none;">
                                                    <li><a id="stopAll" href="#"><i class="icon icon_gou"></i>停止所有视频</a></li>
                                                    <li><a id="clearAll" href="#"><i class="icon icon_gou"></i>清除所有视频</a></li>
                                                </ul>
                                            </span>
                                            <span><i class="icon icon_num9"></i></span>
                                        </i-Col>
                                    </Row> 
                                </i-Header>
                                <i-Content style="height:100%;padding: 10px;">
                                    <div class="full" style="position: relative;">
                                        <div class="full" id="videoContent" ref="videoContent">
                                            <div>
                                                <video id="video0" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video1" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video2" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video3" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video4" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video5" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video6" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video7" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video8" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video9" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video10" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video11" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video12" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video13" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video14" class="video-js" controls poster="" >  
                                            </div>
                                            <div>
                                                <video id="video15" class="video-js" controls poster="" >  
                                            </div>
                                        </div>                                 
                                    </div>
                                </i-Content>
                            </Layout>
                        </Layout>
                </i-Content>
            </Layout>   
        </Layout>   
    </div>
    <script src="js/polyfill.min.js"></script>
    <script src="dist/vue.min.js"></script>
    <script src="dist/iview.min.js"></script>
    <script src="js/gps51-jquery.js"></script>
    <script src="js/config.js"></script>
    <script src="js/dateformat.js"></script>
    <script src="js/js.cookie.min.js"></script>
    <script src="js/util.js"></script>

    <script>
        var deviceid = utils.getParameterByName("deviceid");
        var token = utils.getParameterByName("token");

        var vRoot = new Vue({
            el:"#container",
            data:{
                videoContentWH:{
                    width:0,
                    height:0
                },
                videoProperty:{},
                videoPropertyModal:false,
                isFullScreen:false,
                videoNumber:16,
                videoIns:[],
                Spin:false,
            },
            methods: {
                queryVideoProperty:function(){
                    this.Spin = true;
                    var url = myUrls.queryVideoProperty(), that = this;
                    utils.sendAjax(url,{deviceid:deviceid},function (data) { 
                        var status = data.status ;
                        if(status === 0 ){
                            that.$Message.success("查询成功");  
                            that.videoProperty = data;
                            that.videoPropertyModal = true;
                        }else if(status === 1){
                            that.$Message.error();
                        }else if(status === 2){
                            that.$Message.error("设备不在线");   
                        }else if(status === 3){
        
                        }else if(status === 4){

                        }else if(status === 5){
                            that.$Message.error("错误:" + data.cause);
                        }
                        that.Spin = false;
                    })
                },
                handleStartVideos:function(){
                    var url = myUrls.startVideos() , me = this;
                    utils.sendAjax(url,{deviceid:deviceid, channels:[1]},function (resp) {
                        var records = resp.records , status = resp.status ;
                        if(status === 0 && records.length){
                            me.$Message.success("开始成功")
                            for(var i = 0; i < records.length;i++){
                                var item = records[i];
                                var player = me.videoIns[i];
                                player.src(item.playurl);
                                player.play();
                            }
                        }else if(status === 1){
                            me.$Message.error();
                        }else if(status === 2){
                            me.$Message.error("设备不在线");   
                        }else if(status === 3){
        
                        }else if(status === 4){

                        }else if(status === 5){
                            me.$Message.error("错误:" + resp.cause);
                        }
                    })
                },
                handleStopVideos:function(){
                    var url = myUrls.stopVideos() , me = this;
                    utils.sendAjax(url,{deviceid:deviceid, channels:[1],videoclosetype:0},function (resp) {
                        if(resp.status === 0){
                            me.$Message.success("停止成功")
                        }else if(status === 1){

                        }else if(status === 2){
                            me.$Message.error("设备不在线");   
                        }else if(status === 3){
        
                        }else if(status === 4){

                        }else if(status === 5){
                            me.$Message.error("错误:" + resp.cause);
                        }
                    })
                },
                handleFullScreen:function(){
                    var main = this.$refs.videoContent;
                    if (this.isFullScreen) {
                        if (document.exitFullscreen) {
                        document.exitFullscreen()
                        } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen()
                        } else if (document.webkitCancelFullScreen) {
                        document.webkitCancelFullScreen()
                        } else if (document.msExitFullscreen) {
                        document.msExitFullscreen()
                        }
                    } else {
                        if (main.requestFullscreen) {
                        main.requestFullscreen()
                        } else if (main.mozRequestFullScreen) {
                        main.mozRequestFullScreen()
                        } else if (main.webkitRequestFullScreen) {
                        main.webkitRequestFullScreen()
                        } else if (main.msRequestFullscreen) {
                        main.msRequestFullscreen()
                        }
                    }
                    this.isFullScreen = false;
                },
                displayAndHideVideos:function(toOpensIndex){
                    for(var i = 0 ; i < 16 ;i++){
                        var player =this.videoIns[i];
                        if(i < toOpensIndex)
                        {
                            // if(player.paused())
                            // {
                            //     player.play();
                            // }
                        }
                        else
                        {
                            player.pause();
                            
                        }                         
                    }
                },
                openAndCloseVideoWindows:function(toOpensIndex){
                    this.videoNumber = toOpensIndex;
                    this.resizeVideoWindows(toOpensIndex);
                },
                resizeVideoWindows:function(count){
                    var width = this.videoContentWH.width;
                    var height = this.videoContentWH.height;
                    this.displayAndHideVideos(count);

                    switch(count)
                    {
                        case 1:
                            var player = this.videoIns[0];
                            player.width(width);
                            player.height(height);
                            break;
                        case 4:
                            for(var i = 0 ; i < 4;i++){
                                var player = this.videoIns[i];
                                //player.stopTrackingCurrentTime();
                                player.width(width/2);
                                player.height(height/2);    
                            }
                            break;
                        case 6:
                            var singlewidth = width/3;
                            var singleheight = height/3;
                            for(var i = 0 ; i < 6;i++){
                                var player =  this.videoIns[i];
                                if(i === 0){
                                    player.width(singlewidth*2);
                                    player.height(singleheight*2);  
                                } else {
                                    player.width(singlewidth);
                                    player.height(singleheight);   
                                }
                            }
                            break;
                        case 8:
                            var singlewidth = width/4;
                            var singleheight = height/4;
                            for(var i = 0 ; i < 8;i++){
                                var player =  this.videoIns[i];
                                if(i === 0){
                                    player.width(singlewidth*3);
                                    player.height(singleheight*3);  
                                } else {
                                    player.width(singlewidth);
                                    player.height(singleheight);   
                                }
                            }
                            break;
                        case 9: 
                            for(var i = 0 ; i < 9;i++){
                                var player =  this.videoIns[i];
                                player.width(width/3);
                                player.height(height/3);    
                            }
                        break;
                        case 16:
                            for(var i = 0 ; i < 16;i++){
                                var player =  this.videoIns[i];
                                player.width(width/4);
                                player.height(height/4);    
                            }
                        break;
                        }
                },
                initVideo:function(index){
                    var player = videojs('video'+index , {
                        autoplay: false ,
                        preload:false,
                        controlBar: {
                            progressControl: false,
                            liveDisplay: true,
                        },
                        techOrder: ['html5','flash'],
                        sources: [
                                // { 
                                //     // src: 'rtmp://58.200.131.2:1935/livetv/hunantv',
                                //     src:'',
                                //     type: 'rtmp/flv'
                                // }
                            ],
                    });
                    this.videoIns.push(player);
                },
                initApp:function(){
                    var videoContent = this.$refs.videoContent;
                    this.videoContentWH = videoContent.getBoundingClientRect();
                    for(var i = 0 ; i < 16 ; i++){
                        this.initVideo(i);
                    }
                    this.resizeVideoWindows(this.videoNumber);
                }
            },
            computed:{
               
            },
            watch: {
            },
            mounted :function() {
                var that = this; 
                videojs.options.flash.swf = "./videojs/video-js.5.4.2.swf";
                this.$nextTick(function(){ 
                    that.initApp(); 
                    window.onresize = function (){
                        that.videoContentWH = that.$refs.videoContent.getBoundingClientRect();
                        that.resizeVideoWindows(that.videoNumber);
                    }
                });

            },
        })
    </script>
</body>
</html>